# Функциональность вариантов товаров

## Обзор

Добавлена поддержка вариантов товаров с выбором цвета и размера, а также динамическим изменением цены.

## Что было реализовано

### 1. Компоненты

- **ProductVariants** (`src/components/product/product-variants.tsx`) - компонент для выбора цвета и размера
- **ProductDetails** (`src/components/product/product-details.tsx`) - обновленный компонент деталей товара
- **ProductActions** - обновлен для работы с вариантами

### 2. Функциональность

- ✅ Выбор цвета товара
- ✅ Выбор размера товара  
- ✅ Динамическое изменение цены при выборе варианта
- ✅ Отображение наличия для каждого варианта
- ✅ Валидация выбора варианта перед добавлением в корзину
- ✅ Отображение выбранных вариантов в корзине

### 3. База данных

Схема уже поддерживает варианты товаров через модель `ProductVariant`:
- `size` - размер товара
- `color` - цвет товара
- `price` - цена варианта
- `stock` - количество на складе
- `sku` - уникальный артикул варианта

### 4. Store корзины

Обновлен для поддержки вариантов:
- Сохранение выбранного цвета и размера
- Уникальная идентификация товаров по вариантам
- Корректное отображение в корзине

## Как использовать

### Для разработчиков

1. **Добавление вариантов к товару:**
```typescript
await db.productVariant.create({
  data: {
    productId: 'product-id',
    size: 'L',
    color: 'Красный',
    price: 2500,
    stock: 10,
    sku: 'PRODUCT-L-RED',
    isActive: true,
  },
});
```

2. **Получение товара с вариантами:**
```typescript
const product = await db.product.findUnique({
  where: { slug: 'product-slug' },
  include: {
    variants: {
      where: { isActive: true },
      orderBy: { price: 'asc' },
    },
  },
});
```

### Для администраторов

1. **Создание товара с вариантами через админ-панель:**
   - Создайте основной товар
   - Добавьте варианты через API или напрямую в БД

2. **Управление вариантами:**
   - Каждый вариант имеет свой SKU, цену и количество
   - Можно отключать варианты (isActive: false)
   - Цена варианта может отличаться от базовой цены товара

## Тестовые данные

Для добавления вариантов к существующим товарам запустите:

```bash
npx tsx scripts/add-variants.ts
```

Этот скрипт добавит варианты цветов и размеров ко всем товарам в зависимости от их категории.

## Примеры вариантов

### Постельное белье
- Размеры: 1.5-спальный, 2-спальный, Евро
- Цвета: Белый, Серый, Бежевый
- Цены: базовая + 0-800₽ в зависимости от размера

### Подушки  
- Размеры: 50x70, 70x70
- Цвета: Белый, Серый, Бежевый
- Цены: базовая + 0-400₽

### Полотенца
- Размеры: 50x90, 70x140
- Цвета: Белый, Серый, Бежевый  
- Цены: базовая + 0-250₽

## API

### GET /api/products/[slug]
Возвращает товар с вариантами:
```json
{
  "success": true,
  "data": {
    "id": "product-id",
    "title": "Название товара",
    "price": 2000,
    "variants": [
      {
        "id": "variant-id",
        "size": "L",
        "color": "Красный", 
        "price": 2500,
        "stock": 10,
        "sku": "PRODUCT-L-RED"
      }
    ]
  }
}
```

## Корзина

Товары с вариантами отображаются в корзине с указанием выбранного цвета и размера:

```
Комплект постельного белья "Классик"
Цвет: Белый, Размер: 2-спальный
2 500 ₽
```

## Будущие улучшения

- [ ] Визуальные превью цветов
- [ ] Фильтрация по доступным вариантам
- [ ] Массовое управление вариантами в админ-панели
- [ ] Экспорт/импорт вариантов
- [ ] Уведомления о низком остатке по вариантам

